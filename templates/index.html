<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Fridge Chef</title>

    <!-- Google Font -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@600&display=swap" rel="stylesheet">
    <!-- Our CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>

<body>
    <header class="header">
        <h1 class="title">Fridge Chef</h1>
        <p class="tagline">
            Type what ingredients you have â€” Iâ€™ll find recipes you can make.
        </p>
    </header>

    <main class="main">
        <!-- Input / controls -->
        <section class="input-section">
            {% if error %}
                <div class="alert alert-error">
                    {{ error }}
                </div>
            {% endif %}

            <form method="post" class="ingredient-form">
                <label for="ingredients" class="form-label">
                    Enter ingredients (comma separated):
                </label>
                <div class="form-row">
                    <input
                        id="ingredients"
                        type="text"
                        name="ingredients"
                        placeholder="e.g. chicken, tomato, cheese"
                        value="{{ user_input }}"
                        maxlength="200"
                        required
                    />
                    <div class="form-row-right">
                        <select name="sort_by" class="sort-select">
                            <option value="best" {% if sort_by == "best" %}selected{% endif %}>Best match</option>
                            <option value="least_missing" {% if sort_by == "least_missing" %}selected{% endif %}>Least missing</option>
                            <option value="simplest" {% if sort_by == "simplest" %}selected{% endif %}>Simplest recipes</option>
                        </select>
                        <button type="submit" name="action" value="search">Search</button>
                    </div>
                </div>
                <p class="hint">
                    Tip: separate ingredients with commas. Keep it short and simple.
                </p>
            </form>

            {% if search_history %}
                <div class="history">
                    <div class="history-header">
                        <span class="history-title">Recent searches</span>
                    </div>
                    <div class="history-chips">
                        {% for query in search_history %}
                            <form method="post" class="history-form">
                                <input type="hidden" name="ingredients" value="{{ query }}">
                                <input type="hidden" name="sort_by" value="{{ sort_by }}">
                                <button type="submit" name="action" value="search" class="history-chip">
                                    ğŸ” {{ query }}
                                </button>
                            </form>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}
        </section>

        <!-- Results -->
        <section class="results-section">
            {% if suggestions %}
                <h2 class="section-title">Recipes you can try:</h2>
                <div class="recipes-grid">
                    {% for recipe in suggestions %}
                        <article class="recipe-card">
                            <div class="recipe-card-header">
                                <h3 class="recipe-name">{{ recipe.name }}</h3>
                                <form method="post" class="fav-form">
                                    <input type="hidden" name="ingredients" value="{{ user_input }}">
                                    <input type="hidden" name="sort_by" value="{{ sort_by }}">
                                    <input type="hidden" name="recipe_name" value="{{ recipe.name }}">
                                    <button type="submit" name="action" value="favorite" class="fav-btn">
                                        {% if recipe.is_favourite %}
                                            â˜… Favourite
                                        {% else %}
                                            â˜† Save
                                        {% endif %}
                                    </button>
                                </form>
                            </div>

                            <!-- Match percentage bar -->
                            <div class="match-row">
                                <span class="match-label">{{ recipe.match_percent }}% match</span>
                                <div class="match-bar-outer">
                                    <div class="match-bar-inner" style="width: {{ recipe.match_percent }}%;"></div>
                                </div>
                                <span class="match-meta">
                                    {{ recipe.matched }}/{{ recipe.total }} ingredients
                                </span>
                            </div>

                            <!-- Cookability + missing ingredients (V4) -->
                            <div class="cookability">
                                {% if recipe.cookability == "can_cook" %}
                                    <span class="cook-green">âœ… You can cook this!</span>
                                {% elif recipe.cookability == "almost" %}
                                    <span class="cook-yellow">ğŸŸ¡ Almost â€” missing {{ recipe.missing|length }} ingredient{% if recipe.missing|length != 1 %}s{% endif %}</span>
                                {% else %}
                                    <span class="cook-red">ğŸ”´ Missing too many ingredients</span>
                                {% endif %}
                            </div>

                            {% if recipe.missing %}
                                <p class="missing-list">
                                    <strong>Missing:</strong> {{ recipe.missing | join(", ") }}
                                </p>
                            {% endif %}

                            <!-- Meta info: cuisine / type / difficulty / time -->
                            <p class="meta-line">
                                <span>ğŸŒ {{ recipe.cuisine }}</span> Â·
                                <span>ğŸ½ {{ recipe.type }}</span> Â·
                                <span>âš™ {{ recipe.difficulty }}</span> Â·
                                <span>â± {{ recipe.time_minutes }} min</span>
                            </p>

                            <!-- Ingredients & description -->
                            <p class="recipe-ings">
                                <strong>Ingredients:</strong>
                                {{ recipe.ingredients | join(", ") }}
                            </p>
                            <p class="recipe-desc">
                                {{ recipe.description }}
                            </p>
                        </article>
                    {% endfor %}
                </div>
            {% elif not error and user_input %}
                <p class="no-results">
                    No recipes found, but there was no specific error. Try adding or changing ingredients.
                </p>
            {% endif %}
        </section>
    </main>

    <footer class="footer">
        <small>Fridge Chef Â· Version 4 â€“ Dataset, cookability & smarter matching</small>
    </footer>
</body>
</html>
